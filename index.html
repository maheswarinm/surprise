<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Princess Day â€” Surprise for Mitsuri</title>
  <style>
    :root{--bg:#fff0f8;--primary:#ff69b4;--accent:#ffd1e8;--muted:#6b6b6b}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,Helvetica,sans-serif;background:linear-gradient(180deg,var(--bg),#fff);color:#222}
    .center{display:flex;align-items:center;justify-content:center;height:100vh;flex-direction:column;padding:20px}
    .card{background:rgba(255,255,255,0.92);backdrop-filter:blur(6px);border-radius:18px;box-shadow:0 10px 40px rgba(0,0,0,0.08);padding:28px;max-width:760px;width:100%}
    h1{margin:0 0 8px;font-size:30px;color:var(--primary)}
    p.lead{margin:0 0 18px;color:var(--muted)}

    /* intro */
    .intro{display:grid;grid-template-columns:110px 1fr;gap:18px;align-items:center}
    .flower-circle{width:110px;height:110px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #fff, #ffe9f8 40%, #ffd1ef 60%, #ffb7dd 100%);display:flex;align-items:center;justify-content:center;font-size:44px}
    .btn{display:inline-block;padding:10px 16px;border-radius:12px;background:var(--primary);color:white;text-decoration:none;cursor:pointer;border:none;font-weight:700}
    .btn-ghost{background:transparent;border:2px solid var(--primary);color:var(--primary)}

    /* puzzle area */
    .puzzle-wrap{margin-top:18px}
    #sortable{list-style:none;padding:12px;max-width:420px;margin:8px auto;display:flex;flex-direction:column;gap:12px}
    #sortable li{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 16px;background:linear-gradient(180deg,var(--accent),#fff);border-radius:14px;box-shadow:0 6px 18px rgba(255,105,180,0.06);cursor:grab;font-size:22px}
    .badge{display:inline-flex;align-items:center;gap:8px;background:#fff;border-radius:999px;padding:6px 12px;border:2px solid rgba(255,105,180,0.12)}

    .message{margin-top:18px;text-align:center}
    .message img{max-width:220px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.07)}

    /* princess badge popup */
    .popup-badge{position:fixed;left:50%;top:20%;transform:translate(-50%,-200%);background:linear-gradient(180deg,#fff,#fff7fb);padding:18px;border-radius:18px;box-shadow:0 12px 40px rgba(0,0,0,0.12);display:flex;flex-direction:column;align-items:center;gap:8px;transition:transform 600ms cubic-bezier(.2,.9,.2,1),opacity 300ms;opacity:0;z-index:2000}
    .popup-badge.show{transform:translate(-50%,0);opacity:1}
    .popup-badge .crown{font-size:34px}
    .popup-badge .title{font-weight:800;color:var(--primary)}

    .confetti{pointer-events:none;position:fixed;inset:0;display:none;z-index:1500}

    @media(max-width:560px){#sortable li{font-size:20px;padding:10px}}
  </style>
</head>
<body>
  <div class="center">
    <div class="card" id="card">
      <div class="intro" id="intro">
        <div class="flower-circle">ğŸŒ¸</div>
        <div>
          <h1>Princess Day Surprise ğŸ‘‘</h1>
          <p class="lead">A little interactive game for <strong>My Deep</strong>. Click <strong>Start</strong> â€” arrange the princess icons in the right order to unlock your surprise.</p>
          <div style="display:flex;gap:10px;margin-top:8px">
            <button class="btn" id="startBtn">Start</button>
            <div style="margin-left:auto;display:flex;align-items:center;gap:8px">
            </div>
          </div>
        </div>
      </div>

      <div class="puzzle-wrap" id="pwrap" style="display:none">
        <div style="text-align:center;margin-bottom:6px;color:var(--muted)"><small>Drag the items into the correct order from top â†’ bottom (ğŸ‘‘ â†’ ğŸŒ¸ â†’ ğŸŒº â†’ ğŸ’ â†’ ğŸŒ·)</small></div>
        <ul id="sortable"></ul>
        <div class="message" id="message"></div>
      </div>
    </div>
  </div>

  <canvas class="confetti" id="confetti"></canvas>

  <!-- background music: user will upload music.mp3 to repo -->
  <audio id="bgm" src="music.mp3" loop></audio>

  <!-- princess badge popup -->
  <div id="badgePopup" class="popup-badge" aria-hidden="true">
    <div class="crown">ğŸ‘‘</div>
    <div class="title">Deep Sundariiiiiii</div>
  </div>

<script>
// --- Config ---
const WIN_MESSAGE = 'HAPPY PRINCESS DAYYY BABUUU (Deep) haha I thought will meet you inperson but could not. Well I got with alternative idea';
const order = ['ğŸ‘‘','ğŸŒ¸','ğŸŒº','ğŸ’','ğŸŒ·'];

// --- cached DOM references (fixes the previous error) ---
const sortable = document.getElementById('sortable');
const messageEl = document.getElementById('message');
const startBtn = document.getElementById('startBtn');
const howBtn = document.getElementById('howBtn');
const intro = document.getElementById('intro');
const pwrap = document.getElementById('pwrap');
const badgePopup = document.getElementById('badgePopup');

function startMusic(){ const a=document.getElementById('bgm'); a.volume=0.6; a.play().catch(()=>{}); }

// --- Drag-to-arrange puzzle setup ---
function setupPuzzle(){
  sortable.innerHTML = '';
  const shuffled = [...order].sort(()=>Math.random()-0.5);
  shuffled.forEach(symbol => {
    const li = document.createElement('li');
    li.draggable = true;
    li.textContent = symbol;
    li.style.fontSize = '34px';
    // accessibility
    li.setAttribute('role','button');
    li.setAttribute('aria-grabbed','false');

    li.addEventListener('dragstart', dragStart);
    li.addEventListener('dragover', dragOver);
    li.addEventListener('drop', drop);
    li.addEventListener('dragend', dragEnd);

    // also support simple click-to-cycle for touch devices
    li.addEventListener('click', ()=>{
      // rotate the item to bottom
      li.parentNode.appendChild(li);
      checkWin();
    });

    sortable.appendChild(li);
  });
}

let dragItem = null;
function dragStart(e){ dragItem = this; this.setAttribute('aria-grabbed','true'); }
function dragOver(e){ e.preventDefault(); }
function drop(e){ e.preventDefault(); if(this !== dragItem){ this.parentNode.insertBefore(dragItem, this); checkWin(); } }
function dragEnd(e){ if(dragItem) dragItem.setAttribute('aria-grabbed','false'); dragItem = null; }

function checkWin(){
  const cur = [...sortable.children].map(li=>li.textContent);
  if(JSON.stringify(cur) === JSON.stringify(order)) onWin();
}

// --- On win: show message, confetti, flower shower and popup badge, plus Mitsuri dialogue ---
function onWin(){
  window.location.href = "https://maheswarinm.github.io/surprise/nextpage.html";
  startMusic();
  runConfetti();
  showFlowerShower();
  showBadgePopup();
}

// --- Confetti (simple) ---
function runConfetti(){
  try{
    const canvas = document.getElementById('confetti');
    canvas.style.display = 'block';
    canvas.width = innerWidth; canvas.height = innerHeight;
    const ctx = canvas.getContext('2d');
    const pieces = [];
    for(let i=0;i<120;i++) pieces.push({x:Math.random()*canvas.width,y:-Math.random()*canvas.height,w:6+Math.random()*8,h:6+Math.random()*8,rot:Math.random()*360,vx:(Math.random()-0.5)*2,vy:2+Math.random()*4,clr:`hsl(${Math.random()*360},80%,70%)`});
    let t=0;
    function frame(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      pieces.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.rot+=p.vx; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot*Math.PI/180); ctx.fillStyle = p.clr; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore(); });
      if(t++<260) requestAnimationFrame(frame); else canvas.style.display='none';
    }
    frame();
  }catch(e){ console.warn(e); }
}

// --- Flower shower ---
function showFlowerShower(){
  for(let i=0;i<40;i++){
    const f = document.createElement('div');
    f.style.position='fixed'; f.style.left=(Math.random()*80+10)+'%'; f.style.top='-10%'; f.style.fontSize=(12+Math.random()*34)+'px'; f.style.pointerEvents='none'; f.style.opacity='0.98';
    f.style.transition='transform 3s linear, top 3s linear, opacity 1s linear';
    f.innerText = ['ğŸŒ¸','ğŸŒº','ğŸ’','ğŸŒ·'][Math.floor(Math.random()*4)];
    document.body.appendChild(f);
    setTimeout(()=>{ f.style.top = (55+Math.random()*30)+'%'; f.style.transform = `rotate(${Math.random()*360}deg)`; }, 50 + i*30);
    setTimeout(()=>{ f.style.opacity=0; setTimeout(()=>f.remove(),1200); }, 3400 + i*20);
  }
}

// --- Badge popup ---
function showBadgePopup(){
  badgePopup.classList.add('show');
  badgePopup.setAttribute('aria-hidden','false');
  setTimeout(()=>{ badgePopup.classList.remove('show'); badgePopup.setAttribute('aria-hidden','true'); }, 5000);
}

// --- UI wiring ---
startBtn.addEventListener('click', ()=>{
  intro.style.display = 'none';
  pwrap.style.display = 'block';
  setupPuzzle();
  // startMusic(); // moved to onWin to avoid autoplay issues; will play on win (or uncomment to play on start)
});
howBtn.addEventListener('click', ()=>{
  alert('Drag the items to reorder them. The correct order is: ğŸ‘‘ â†’ ğŸŒ¸ â†’ ğŸŒº â†’ ğŸ’ â†’ ğŸŒ·. On touch devices you can tap an item to move it to the bottom.');
});
</script>
</body>
</html>
